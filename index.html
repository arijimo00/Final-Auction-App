<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1.0"
  />
  <title>Player Auction System ‚Äî Cloud Sync</title>
  <style>
    /* ‚Äî‚Äî ORIGINAL STYLES KEPT (from your file) ‚Äî‚Äî */
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);min-height:100vh;color:#333}
    .container{max-width:1400px;margin:0 auto;padding:20px}
    .header{background:rgba(255,255,255,.95);border-radius:15px;padding:20px;margin-bottom:20px;box-shadow:0 10px 30px rgba(0,0,0,.2)}
    .header h1{color:#764ba2;text-align:center;font-size:2.5em;margin-bottom:10px}
    .current-bid-display{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);border-radius:15px;padding:30px;margin-bottom:20px;box-shadow:0 10px 30px rgba(0,0,0,.2);color:white;text-align:center}
    .player-info{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:20px;margin-bottom:20px}
    .info-card{background:rgba(255,255,255,.1);backdrop-filter:blur(10px);border-radius:10px;padding:15px;border:1px solid rgba(255,255,255,.2)}
    .info-card h3{font-size:.9em;opacity:.9;margin-bottom:5px}
    .info-card p{font-size:1.5em;font-weight:bold}
    .timers-section{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:20px;margin-bottom:20px}
    .timer-card{border-radius:15px;padding:20px;box-shadow:0 5px 20px rgba(0,0,0,.1);text-align:center;transition:all .3s}
    .timer-card.inactive{background:#6c757d;color:white}
    .timer-card.active{background:#dc3545;color:white}
    .timer-display{font-size:3em;font-weight:bold;margin:10px 0;font-family:'Courier New',monospace}
    .timer-card.inactive .timer-display{color:rgba(255,255,255,.8)}
    .timer-card.active .timer-display{color:white}
    .nomination-section{background:white;border-radius:15px;padding:25px;margin-bottom:20px;box-shadow:0 5px 20px rgba(0,0,0,.1)}
    .nomination-form{display:grid;grid-template-columns:1fr 1fr auto;gap:15px;align-items:end}
    .form-group{display:flex;flex-direction:column}
    .form-group label{margin-bottom:5px;font-weight:bold;color:#764ba2}
    .form-group input{padding:10px;border:2px solid #e0e0e0;border-radius:8px;font-size:16px;transition:all .3s}
    .form-group input:focus{border-color:#667eea;outline:none}
    .teams-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(380px,1fr));gap:20px;margin-bottom:20px}
    .team-card{background:white;border-radius:15px;padding:20px;box-shadow:0 5px 20px rgba(0,0,0,.1);transition:transform .3s}
    .team-card:hover{transform:translateY(-5px);box-shadow:0 10px 30px rgba(0,0,0,.15)}
    .team-header{display:flex;align-items:center;margin-bottom:15px;padding-bottom:15px;border-bottom:2px solid #f0f0f0}
    .team-logo{width:60px;height:60px;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);border-radius:50%;display:flex;align-items:center;justify-content:center;color:white;font-weight:bold;font-size:1.5em;margin-right:15px}
    .team-info h3{color:#333;margin-bottom:5px}
    .coaches{font-size:.9em;color:#666}
    .budget-display{background:#f8f9fa;border-radius:10px;padding:15px;margin-bottom:15px;text-align:center}
    .budget-amount{font-size:2em;font-weight:bold;color:#28a745}
    .bid-buttons{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-bottom:15px}
    .bid-btn{padding:12px;border:none;border-radius:8px;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:white;font-weight:bold;cursor:pointer;transition:all .3s}
    .bid-btn:hover:not(:disabled){transform:scale(1.05);box-shadow:0 5px 15px rgba(102,126,234,.4)}
    .bid-btn:disabled{background:#ccc;cursor:not-allowed;opacity:.6}
    .bid-btn.max-bid{background:linear-gradient(135deg,#f093fb 0%,#f5576c 100%);grid-column:span 3}
    .custom-bid-container{display:grid;grid-template-columns:1fr auto;gap:10px}
    .custom-bid-input{padding:10px;border:2px solid #e0e0e0;border-radius:8px;font-size:16px}
    .admin-console{background:white;border-radius:15px;padding:25px;margin-bottom:20px;box-shadow:0 5px 20px rgba(0,0,0,.1)}
    .admin-buttons{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:15px}
    .admin-btn{padding:15px;border:none;border-radius:10px;font-weight:bold;font-size:16px;cursor:pointer;transition:all .3s}
    .admin-btn.start{background:#28a745;color:white}
    .admin-btn.pause{background:#ffc107;color:#333}
    .admin-btn.undo{background:#17a2b8;color:white}
    .admin-btn.reset{background:#dc3545;color:white}
    .admin-btn.export{background:#6610f2;color:white}
    .admin-btn:hover{transform:scale(1.05);box-shadow:0 5px 15px rgba(0,0,0,.2)}
    .data-section{background:white;border-radius:15px;padding:25px;margin-bottom:20px;box-shadow:0 5px 20px rgba(0,0,0,.1)}
    .data-section h2{color:#764ba2;margin-bottom:15px}
    .data-table{width:100%;border-collapse:collapse}
    .data-table th,.data-table td{padding:12px;text-align:left;border-bottom:1px solid #e0e0e0}
    .data-table th{background:#f8f9fa;font-weight:bold;color:#667eea}
    .data-table tr:hover{background:#f8f9fa}
    #team-setup-table input[type="text"]{width:100%;padding:8px;border:1px solid #ddd;border-radius:4px;font-size:14px}
    #team-setup-table input[type="file"]{font-size:12px}
    .logo-preview{width:40px;height:40px;border-radius:50%;object-fit:cover;display:block;margin-top:5px}
    .clear-btn{padding:5px 10px;background:#dc3545;color:white;border:none;border-radius:5px;cursor:pointer;font-size:12px}
    .clear-btn:hover{background:#c82333}
    .modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.5);z-index:1000;align-items:center;justify-content:center}
    .modal.active{display:flex}
    .modal-content{background:white;border-radius:15px;padding:30px;max-width:600px;width:90%;max-height:80vh;overflow-y:auto}
    .modal-header{margin-bottom:20px}
    .modal-header h2{color:#764ba2}
    .setup-form{display:flex;flex-direction:column;gap:15px}
    .setup-form .form-group{display:flex;flex-direction:column}
    .setup-form textarea{padding:10px;border:2px solid #e0e0e0;border-radius:8px;font-size:14px;min-height:100px;resize:vertical}
    .modal-buttons{display:flex;gap:10px;margin-top:20px}
    .modal-btn{flex:1;padding:12px;border:none;border-radius:8px;font-weight:bold;cursor:pointer;transition:all .3s}
    .modal-btn.primary{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:white}
    .modal-btn.secondary{background:#f0f0f0;color:#333}
    @media (max-width: 768px){.teams-grid{grid-template-columns:1fr}.nomination-form{grid-template-columns:1fr}.bid-buttons{grid-template-columns:repeat(2,1fr)}.timer-display{font-size:2em}}
    .player-tag{display:inline-flex;align-items:center;padding:8px 12px;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:white;border-radius:20px;font-size:14px;transition:all .3s;animation:slideIn .3s ease-out}
    .player-tag:hover{transform:scale(1.05);box-shadow:0 3px 10px rgba(102,126,234,.3)}
    .player-tag .remove-player{margin-left:8px;cursor:pointer;background:rgba(255,255,255,.2);border-radius:50%;width:20px;height:20px;display:flex;align-items:center;justify-content:center;font-size:12px;transition:all .3s}
    .player-tag .remove-player:hover{background:rgba(255,255,255,.4)}
    .roster-card{background:linear-gradient(135deg,#f5f7fa 0%,#c3cfe2 100%);border-radius:12px;padding:20px;box-shadow:0 4px 15px rgba(0,0,0,.1);border:2px solid rgba(102,126,234,.2)}
    .roster-header{display:flex;align-items:center;margin-bottom:15px;padding-bottom:12px;border-bottom:2px solid rgba(102,126,234,.3)}
    .roster-logo{width:45px;height:45px;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);border-radius:50%;display:flex;align-items:center;justify-content:center;color:white;font-weight:bold;font-size:1.2em;margin-right:12px;overflow:hidden}
    .roster-logo img{width:100%;height:100%;object-fit:cover}
    .roster-info{flex-grow:1}
    .roster-info h4{margin:0;color:#333;font-size:1.1em}
    .roster-stats{display:flex;gap:15px;font-size:.85em;color:#666;margin-top:3px}
    .roster-players{min-height:100px;max-height:250px;overflow-y:auto}
    .roster-player{display:flex;justify-content:space-between;align-items:center;padding:10px;margin:8px 0;background:white;border-radius:8px;box-shadow:0 2px 5px rgba(0,0,0,.05);transition:all .3s}
    .roster-player:hover{transform:translateX(5px);box-shadow:0 3px 10px rgba(0,0,0,.1)}
    .roster-player .player-name{font-weight:600;color:#333}
    .roster-player .player-cost{color:#28a745;font-weight:bold}
    .roster-empty{text-align:center;color:#999;padding:30px;font-style:italic}
    .roster-summary{margin-top:15px;padding-top:12px;border-top:2px solid rgba(102,126,234,.3);display:flex;justify-content:space-between;font-size:.9em}
    .roster-summary .budget-left{color:#28a745;font-weight:bold}
    .roster-summary .total-spent{color:#dc3545;font-weight:bold}
    @keyframes pulse{0%{transform:scale(1)}50%{transform:scale(1.05)}100%{transform:scale(1)}}
    .pulse-animation{animation:pulse 2s infinite}
    .highlight-bid{background:linear-gradient(135deg,#ffd93d 0%,#ffb347 100%)!important;animation:pulse 1s}
    @keyframes slideIn{from{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}
    /* small status strip */
    .room-strip{margin-top:8px;text-align:center;font-size:.9em;color:#555}
    .mono{font-family:ui-monospace, Menlo, Consolas, monospace}
  </style>
</head>
<body>
  <div class="container">
    <!-- Header -->
    <div class="header">
      <h1>üèÜ Player Auction System</h1>
      <div class="room-strip">
        Room: <span id="room-label" class="mono">‚Ä¶</span> ‚Äî
        Share link: <span class="mono" id="share-link">‚Ä¶</span>
      </div>
    </div>

    <!-- Current Bid Display -->
    <div class="current-bid-display">
      <h2 style="margin-bottom: 20px;">Current Auction</h2>
      <div class="player-info">
        <div class="info-card">
          <h3>Current Player</h3>
          <p id="current-player">-</p>
        </div>
        <div class="info-card" style="display:flex;flex-direction:column;gap:10px;">
          <div>
            <h3 style="margin-bottom:5px;">Previous Bid</h3>
            <p id="previous-bid" style="color:#ffb3b3;margin:0;">-</p>
          </div>
          <div>
            <h3 style="margin-bottom:5px;">Previous Leader</h3>
            <p id="previous-leader" style="margin:0;">-</p>
          </div>
        </div>
        <div class="info-card" style="display:flex;flex-direction:column;gap:10px;">
          <div>
            <h3 style="margin-bottom:5px;">Current Bid</h3>
            <p id="current-bid" style="color:#ffd93d;margin:0;">-</p>
          </div>
          <div>
            <h3 style="margin-bottom:5px;">Leading Team</h3>
            <p id="leading-team" style="margin:0;">-</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Timers -->
    <div class="timers-section">
      <div class="timer-card inactive" id="countdown-timer-card">
        <h3>‚è∞ Bid Countdown</h3>
        <div class="timer-display" id="countdown-timer">--</div>
        <p>Last chance to bid!</p>
      </div>
      <div class="timer-card inactive" id="nomination-timer-card">
        <h3>‚è±Ô∏è Nomination Timer</h3>
        <div class="timer-display" id="nomination-timer">--</div>
        <p>Time to nominate</p>
      </div>
    </div>

    <!-- Nomination Section -->
    <div class="nomination-section">
      <h2 style="color:#764ba2;margin-bottom:15px;">
        Player Nomination - <span id="nomination-team-name">Waiting to Start</span>
      </h2>
      <div class="nomination-form">
        <div class="form-group">
          <label>Player Name</label>
          <input type="text" id="player-name-input" placeholder="Enter player name" />
        </div>
        <div class="form-group">
          <label>Starting Bid (k)</label>
          <input type="number" id="starting-bid-input" placeholder="Min: 2k" min="2" step="0.5" />
        </div>
        <button class="bid-btn" id="nominate-btn" onclick="nominatePlayer()">Nominate</button>
      </div>
    </div>

    <!-- Team Bidding Sections -->
    <div class="teams-grid" id="teams-container"></div>

    <!-- Team Rosters Section -->
    <div class="data-section">
      <h2>Current Team Rosters</h2>
      <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:20px;margin-top:20px;">
        <div id="team-rosters" style="display:contents;"></div>
      </div>
    </div>

    <!-- Team Setup Section -->
    <div class="data-section" id="team-setup-section">
      <h2>Team Setup</h2>
      <p style="color:#666;margin-bottom:15px;">Configure all teams before starting the auction</p>
      <div style="overflow-x:auto;">
        <table class="data-table" id="team-setup-table">
          <thead>
            <tr>
              <th>Team #</th>
              <th>Team Name</th>
              <th>Coaches Names</th>
              <th>Logo</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
      <div style="margin-top:15px;display:flex;gap:10px;">
        <button class="admin-btn" style="background:#28a745;" onclick="saveTeamSetup()">üíæ Save Team Configuration</button>
        <button class="admin-btn" style="background:#17a2b8;" onclick="loadDefaultTeams()">üìù Load Sample Teams</button>
      </div>
    </div>

    <!-- Player Management Section -->
    <div class="data-section" id="player-management-section">
      <h2>Player Management</h2>
      <div style="margin-bottom:20px;">
        <div class="form-group" style="margin-bottom:15px;">
          <label style="font-weight:bold;color:#764ba2;margin-bottom:5px;display:block;">
            Add Players (one per line or comma-separated)
          </label>
          <textarea id="player-input" style="width:100%;min-height:100px;padding:10px;border:2px solid #e0e0e0;border-radius:8px;font-size:14px;" placeholder="Enter player names...
Example:
Virat Kohli
MS Dhoni
Rohit Sharma
or
Player1, Player2, Player3"></textarea>
        </div>
        <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:10px;">
          <button class="admin-btn" style="background:#28a745;" onclick="addPlayers()">‚ûï Add Players</button>
          <button class="admin-btn" style="background:#dc3545;" onclick="clearPlayerInput()">üóëÔ∏è Clear Input</button>
          <button class="admin-btn" style="background:#17a2b8;" onclick="loadSamplePlayers()">üìã Load Sample Players</button>
        </div>
      </div>

      <div style="margin-bottom:15px;padding:15px;background:#f8f9fa;border-radius:10px;">
        <div style="display:flex;justify-content:space-between;align-items:center;">
          <div><strong>Total Available Players:</strong> <span id="available-count" style="color:#28a745;font-size:1.2em;">0</span></div>
          <div><strong>Already Drafted:</strong> <span id="drafted-count" style="color:#dc3545;font-size:1.2em;">0</span></div>
        </div>
      </div>

      <div style="margin-bottom:15px;">
        <input type="text" id="player-search" placeholder="üîç Search players..." style="width:100%;padding:10px;border:2px solid #e0e0e0;border-radius:8px;font-size:14px;" onkeyup="searchPlayers()" />
      </div>

      <div style="max-height:300px;overflow-y:auto;border:1px solid #e0e0e0;border-radius:8px;padding:10px;">
        <div id="available-players-list" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:10px;"></div>
      </div>
    </div>

    <!-- Admin Console -->
    <div class="admin-console">
      <h2 style="color:#764ba2;margin-bottom:15px;">Admin Console</h2>
      <div class="admin-buttons">
        <button class="admin-btn start" onclick="startAuction()">‚ñ∂Ô∏è Start Auction</button>
        <button class="admin-btn pause" onclick="pauseAuction()">‚è∏Ô∏è Pause Auction</button>
        <button class="admin-btn undo" onclick="undoLastBid()">‚Ü©Ô∏è Undo Last Bid</button>
        <button class="admin-btn reset" onclick="resetAuction()">üîÑ Reset Auction</button>
        <button class="admin-btn export" onclick="exportData()">üìä Export to Sheets</button>
      </div>
    </div>

    <!-- Bid History -->
    <div class="data-section">
      <h2>Bid History</h2>
      <table class="data-table">
        <thead>
          <tr><th>Timestamp</th><th>Player</th><th>Team</th><th>Bid Amount</th></tr>
        </thead>
        <tbody id="bid-history"></tbody>
      </table>
    </div>

    <!-- Drafted Players -->
    <div class="data-section">
      <h2>Drafted Players - History</h2>
      <table class="data-table">
        <thead>
          <tr><th>Player</th><th>Team</th><th>Final Bid</th></tr>
        </thead>
        <tbody id="drafted-players"></tbody>
      </table>
    </div>
  </div>

  <!-- Firebase + App Logic (module) -->
  <script type="module">
    /***********************
     * Firebase (v10 modular) ‚Äî Realtime Database for global sync
     ***********************/
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-app.js";
    import {
      getDatabase, ref, onValue, runTransaction, set, get, child, serverTimestamp
    } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-database.js";

    // üëâ Fill these with your Firebase project values
    const firebaseConfig = {
      apiKey: "AIzaSyAIvNElUUUa2eo1qcEpQnspGKOnIQzUhOo",
      authDomain: "dtt-s9-auction.firebaseapp.com",
      databaseURL: "https://dtt-s9-auction-default-rtdb.firebaseio.com",
      projectId: "dtt-s9-auction",
      storageBucket: "dtt-s9-auction.firebasestorage.app",
      messagingSenderId: "754197878953",
      appId: "1:754197878953:web:f301e8c0b96ed11c84f1b8",
    };

    // Small helper: room from URL (?room=my-auction); if missing, prompt once.
    const url = new URL(window.location.href);
    const roomParam = url.searchParams.get("room") || prompt("Enter a room ID (letters/numbers/dashes):", "season9");
    if (!url.searchParams.get("room")) {
      url.searchParams.set("room", roomParam || "room-1");
      window.history.replaceState({}, "", url.toString());
    }
    const ROOM_ID = url.searchParams.get("room") || "room-1";
    document.getElementById("room-label").textContent = ROOM_ID;
    document.getElementById("share-link").textContent = window.location.href;

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const roomRef = ref(db, `rooms/${ROOM_ID}`);
    const stateRef = ref(db, `rooms/${ROOM_ID}/state`);

    /***********************
     * Default State (kept from your local version)
     ***********************/
    const defaultState = {
      isActive: false,
      isPaused: false,
      currentPlayer: null,
      nominatingTeam: null,
      initialBid: 0,
      currentBid: 0,
      leadingTeam: null,
      previousBid: 0,
      previousLeader: null,
      teams: [],
      bidHistory: [],
      draftedPlayers: [],
      availablePlayers: [],
      nominationOrder: [],
      currentNominationIndex: 0,
      roundNumber: 1,
      // cloud timers
      bidWindowOpensAt: null, // epoch ms
      bidWindowEndsAt: null,  // epoch ms
      nominationEndsAt: null  // epoch ms
    };

    // Local mirror of state to render UI
    let auctionState = structuredClone(defaultState);

    // Prevent tight finalize loops
    let lastFinalizeAttempt = 0;
    let lastAutoNomAttempt = 0;

    /***********************
     * Cloud-state helpers
     ***********************/
    async function ensureRoom() {
      const snap = await get(roomRef);
      if (!snap.exists()) {
        await set(roomRef, { createdAt: serverTimestamp(), state: defaultState });
      }
    }
    await ensureRoom();

    onValue(stateRef, (snapshot) => {
      const cloud = snapshot.val();
      if (!cloud) return;
      auctionState = cloud;
      // Re-render everything whenever state changes
      renderAll();
    });

    // Transaction wrapper that updates the whole state atomically
    function txUpdate(mutator) {
      return runTransaction(stateRef, (s) => {
        const state = s || structuredClone(defaultState);
        mutator(state);
        return state;
      });
    }

    /***********************
     * ‚Äî‚Äî‚Äî UI from your original app (render funcs kept) ‚Äî‚Äî‚Äî
     ***********************/
    function initializeTeamSetupTable() {
      const tbody = document.querySelector('#team-setup-table tbody');
      tbody.innerHTML = '';
      for (let i = 0; i < 6; i++) {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>Team ${i + 1}</td>
          <td><input type="text" id="team-name-${i}" placeholder="Enter team name" value=""></td>
          <td><input type="text" id="team-coaches-${i}" placeholder="Coach names" value=""></td>
          <td>
            <input type="file" id="team-logo-${i}" accept="image/*">
            <img id="logo-preview-${i}" class="logo-preview" style="display:none;">
          </td>
          <td><button class="clear-btn" onclick="clearTeamRow(${i})">Clear</button></td>
        `;
        tbody.appendChild(row);
        // Attach preview listener
        row.querySelector(`#team-logo-${i}`).addEventListener('change', () => previewLogo(i));
      }
    }

    function previewLogo(teamIndex) {
      const input = document.getElementById(`team-logo-${teamIndex}`);
      const preview = document.getElementById(`logo-preview-${teamIndex}`);
      if (input.files && input.files[0]) {
        const reader = new FileReader();
        reader.onload = (e) => {
          preview.src = e.target.result;
          preview.style.display = 'block';
        };
        reader.readAsDataURL(input.files[0]);
      }
    }

    window.clearTeamRow = function(index) {
      document.getElementById(`team-name-${index}`).value = '';
      document.getElementById(`team-coaches-${index}`).value = '';
      document.getElementById(`team-logo-${index}`).value = '';
      const preview = document.getElementById(`logo-preview-${index}`);
      preview.src = '';
      preview.style.display = 'none';
    };

    function renderTeams() {
      const container = document.getElementById('teams-container');
      container.innerHTML = '';
      auctionState.teams.forEach(team => {
        const teamCard = document.createElement('div');
        teamCard.className = 'team-card';
        teamCard.id = `team-${team.id}`;

        let logoContent = team.logo;
        if (team.logoUrl) {
          logoContent = `<img src="${team.logoUrl}" style="width:100%;height:100%;object-fit:cover;border-radius:50%;">`;
        }

        teamCard.innerHTML = `
          <div class="team-header">
            <div class="team-logo">${logoContent || team.name?.charAt(0).toUpperCase()}</div>
            <div class="team-info">
              <h3>${team.name}</h3>
              <div class="coaches">${team.coaches}</div>
            </div>
          </div>
          <div class="budget-display">
            <div>Remaining Budget</div>
            <div class="budget-amount">‚Çπ${team.budget}k</div>
            <div style="font-size:.9em;color:#666;">Max Bid: ‚Çπ${calculateMaxBid(team)}k</div>
          </div>
          <div class="bid-buttons">
            <button class="bid-btn" onclick="placeBid(${team.id}, 0.5)">+0.5k</button>
            <button class="bid-btn" onclick="placeBid(${team.id}, 1)">+1k</button>
            <button class="bid-btn" onclick="placeBid(${team.id}, 2)">+2k</button>
            <button class="bid-btn" onclick="placeBid(${team.id}, 5)">+5k</button>
            <button class="bid-btn" onclick="placeBid(${team.id}, 10)">+10k</button>
            <button class="bid-btn max-bid" onclick="placeMaxBid(${team.id})">MAX BID</button>
          </div>
          <div class="custom-bid-container">
            <input type="number" class="custom-bid-input" id="custom-bid-${team.id}" placeholder="Custom bid (k)" step="0.5">
            <button class="bid-btn" onclick="placeCustomBid(${team.id})">Place Custom</button>
          </div>
        `;
        container.appendChild(teamCard);
      });

      // Enable/disable bid buttons depending on state
      const disabled = !auctionState.isActive || auctionState.isPaused || !auctionState.currentPlayer;
      document.querySelectorAll('.team-card .bid-btn').forEach(btn => {
        btn.disabled = disabled;
      });
      document.getElementById('nominate-btn').disabled = !auctionState.isActive || auctionState.isPaused;
    }

    function calculateMaxBid(team) {
      const playersNeeded = 6 - (team.players?.length || 0);
      const reserveBudget = Math.max(0, (playersNeeded - 1) * 2);
      return Math.max(2, team.budget - reserveBudget);
    }

    function updateBidHistoryTable() {
      const tbody = document.getElementById('bid-history');
      tbody.innerHTML = '';
      const recentBids = auctionState.bidHistory.slice(-10).reverse();
      recentBids.forEach(bid => {
        const row = tbody.insertRow();
        row.innerHTML = `
          <td>${new Date(bid.ts || Date.now()).toLocaleTimeString()}</td>
          <td>${bid.player}</td>
          <td>${bid.team}</td>
          <td>‚Çπ${bid.amount}k</td>
        `;
      });
    }

    function updateDraftedPlayersTable() {
      const tbody = document.getElementById('drafted-players');
      tbody.innerHTML = '';
      auctionState.draftedPlayers.forEach(draft => {
        const row = tbody.insertRow();
        row.innerHTML = `
          <td>${draft.player}</td>
          <td>${draft.team}</td>
          <td>‚Çπ${draft.finalBid}k</td>
        `;
      });
    }

    function updateTeamRosters() {
      const container = document.getElementById('team-rosters');
      container.innerHTML = '';
      auctionState.teams.forEach(team => {
        const rosterCard = document.createElement('div');
        rosterCard.className = 'roster-card';
        let logoContent = team.logo;
        if (team.logoUrl) logoContent = `<img src="${team.logoUrl}" alt="${team.name}">`;
        const totalSpent = 100 - team.budget;
        const playersCount = team.players?.length || 0;
        const remainingSlots = 6 - playersCount;
        let playersHtml = '';
        if (playersCount > 0) {
          team.players.forEach(p => {
            playersHtml += `
              <div class="roster-player">
                <span class="player-name">${p.name}</span>
                <span class="player-cost">‚Çπ${p.cost}k</span>
              </div>
            `;
          });
        } else {
          playersHtml = '<div class="roster-empty">No players drafted yet</div>';
        }
        rosterCard.innerHTML = `
          <div class="roster-header">
            <div class="roster-logo">${logoContent || team.name?.charAt(0).toUpperCase()}</div>
            <div class="roster-info">
              <h4>${team.name}</h4>
              <div class="roster-stats"><span>Players: ${playersCount}/6</span><span>‚Ä¢</span><span>Slots: ${remainingSlots}</span></div>
            </div>
          </div>
          <div class="roster-players">${playersHtml}</div>
          <div class="roster-summary">
            <span class="budget-left">Budget: ‚Çπ${team.budget}k</span>
            <span class="total-spent">Spent: ‚Çπ${totalSpent}k</span>
          </div>
        `;
        container.appendChild(rosterCard);
      });
    }

    function displayAvailablePlayers() {
      const container = document.getElementById('available-players-list');
      const availableCount = document.getElementById('available-count');
      const draftedCount = document.getElementById('drafted-count');
      availableCount.textContent = auctionState.availablePlayers.length;
      draftedCount.textContent = auctionState.draftedPlayers.length;
      container.innerHTML = '';
      const searchTerm = (document.getElementById('player-search').value || '').toLowerCase();
      const filteredPlayers = auctionState.availablePlayers.filter(p => p.toLowerCase().includes(searchTerm));
      if (filteredPlayers.length === 0) {
        container.innerHTML = '<div style="text-align:center;color:#666;padding:20px;">No players available. Add players above to get started!</div>';
        return;
      }
      filteredPlayers.sort().forEach(player => {
        const tag = document.createElement('div');
        tag.className = 'player-tag';
        tag.innerHTML = `<span>${player}</span><span class="remove-player" title="Remove player">‚úï</span>`;
        tag.querySelector('.remove-player').onclick = () => removePlayer(player);
        container.appendChild(tag);
      });
    }

    function updateNominatingTeamDisplay() {
      const idx = auctionState.nominationOrder[auctionState.currentNominationIndex];
      const team = auctionState.teams[idx];
      if (team) {
        const el = document.getElementById('nomination-team-name');
        el.textContent = `${team.name}'s Turn`;
        el.style.color = '#dc3545';
        el.style.fontWeight = 'bold';
      } else {
        const el = document.getElementById('nomination-team-name');
        el.textContent = 'Waiting to Start';
        el.style.color = '#764ba2';
        el.style.fontWeight = 'normal';
      }
    }

    function renderAll() {
      // Header
      document.getElementById('current-player').textContent = auctionState.currentPlayer || '-';
      document.getElementById('current-bid').textContent = auctionState.currentBid ? `‚Çπ${auctionState.currentBid}k` : '-';
      document.getElementById('leading-team').textContent = auctionState.leadingTeam || '-';
      document.getElementById('previous-bid').textContent = auctionState.previousBid ? `‚Çπ${auctionState.previousBid}k` : '-';
      document.getElementById('previous-leader').textContent = auctionState.previousLeader || '-';

      // Sections
      renderTeams();
      updateTeamRosters();
      updateBidHistoryTable();
      updateDraftedPlayersTable();
      displayAvailablePlayers();
      updateNominatingTeamDisplay();

      // Timer cards mode
      updateTimerCards();
    }

    /***********************
     * Cloud-aware actions (converted from your local functions)
     ***********************/
    window.saveTeamSetup = async function() {
      const teams = [];
      for (let i = 0; i < 6; i++) {
        const name = document.getElementById(`team-name-${i}`).value.trim();
        const coaches = document.getElementById(`team-coaches-${i}`).value.trim();
        const preview = document.getElementById(`logo-preview-${i}`);
        if (!name) { alert(`Please enter a name for Team ${i + 1}`); return; }
        teams.push({
          id: i,
          name,
          logo: (preview && preview.src && preview.style.display !== 'none') ? null : name.charAt(0).toUpperCase(),
          logoUrl: (preview && preview.src && preview.style.display !== 'none') ? preview.src : null,
          coaches: coaches || 'TBD',
          budget: 100,
          players: [],
          maxBid: 100
        });
      }
      await txUpdate(s => {
        s.teams = teams;
        if (!s.nominationOrder || s.nominationOrder.length !== teams.length) {
          s.nominationOrder = [0,1,2,3,4,5];
          s.currentNominationIndex = 0;
        }
      });
      alert('Team configuration saved successfully!');
    };

    window.loadDefaultTeams = function() {
      const defaults = [
        { name:'Mumbai Indians', coaches:'Rohit Sharma & Mahela Jayawardene' },
        { name:'Chennai Kings', coaches:'MS Dhoni & Stephen Fleming' },
        { name:'Delhi Capitals', coaches:'Ricky Ponting & Sourav Ganguly' },
        { name:'Kolkata Knights', coaches:'Brendon McCullum & Jacques Kallis' },
        { name:'Bangalore Royals', coaches:'Virat Kohli & Mike Hesson' },
        { name:'Punjab Warriors', coaches:'KL Rahul & Anil Kumble' },
      ];
      defaults.forEach((t,i)=>{
        document.getElementById(`team-name-${i}`).value = t.name;
        document.getElementById(`team-coaches-${i}`).value = t.coaches;
      });
      alert('Sample teams loaded! Click "Save Team Configuration" to apply.');
    };

    window.addPlayers = async function() {
      const raw = document.getElementById('player-input').value.trim();
      if (!raw) { alert('Please enter player names'); return; }
      let newPlayers = [];
      if (raw.includes(',')) newPlayers = raw.split(',').map(p=>p.trim()).filter(Boolean);
      else newPlayers = raw.split('\n').map(p=>p.trim()).filter(Boolean);
      const unique = [...new Set(newPlayers)];
      await txUpdate(s => {
        if (!Array.isArray(s.availablePlayers)) s.availablePlayers = [];
        unique.forEach(p => {
          if (!s.availablePlayers.includes(p) && !s.draftedPlayers.some(dp => dp.player === p)) {
            s.availablePlayers.push(p);
          }
        });
      });
      document.getElementById('player-input').value = '';
    };

    window.clearPlayerInput = function(){ document.getElementById('player-input').value=''; };

    window.loadSamplePlayers = function() {
      const sample = [
        'Virat Kohli','MS Dhoni','Rohit Sharma','KL Rahul','Hardik Pandya',
        'Jasprit Bumrah','Ravindra Jadeja','Rishabh Pant','Shikhar Dhawan',
        'Mohammed Shami','Yuzvendra Chahal','Suryakumar Yadav','Shreyas Iyer',
        'Axar Patel','Deepak Chahar','Shardul Thakur','Washington Sundar',
        'Ishan Kishan','Prithvi Shaw','Ruturaj Gaikwad','Shubman Gill',
        'Mohammed Siraj','Kuldeep Yadav','Bhuvneshwar Kumar','Umesh Yadav'
      ];
      document.getElementById('player-input').value = sample.join('\n');
    };

    window.removePlayer = async function(playerName) {
      if (!confirm(`Remove ${playerName} from available players?`)) return;
      await txUpdate(s => {
        const i = s.availablePlayers.indexOf(playerName);
        if (i > -1) s.availablePlayers.splice(i,1);
      });
    };

    window.searchPlayers = function(){ displayAvailablePlayers(); };

    window.startAuction = async function() {
      if (!auctionState.teams || auctionState.teams.length === 0) { alert('Configure teams first.'); return; }
      if (!auctionState.availablePlayers || auctionState.availablePlayers.length === 0) { alert('Add players first.'); return; }
      await txUpdate(s => {
        s.isActive = true;
        s.isPaused = false;
        if (!s.nominationOrder || s.nominationOrder.length !== s.teams.length) {
          s.nominationOrder = s.teams.map(t=>t.id);
        }
        s.currentNominationIndex = 0;
        s.roundNumber = 1;
        s.currentPlayer = null;
        s.nominationEndsAt = Date.now() + 90_000; // 1:30
        s.bidWindowOpensAt = null;
        s.bidWindowEndsAt = null;
      });
      alert('Auction started!');
    };

    window.pauseAuction = async function() {
      if (!auctionState.isActive) { alert('No active auction to pause!'); return; }
      await txUpdate(s => { s.isPaused = !s.isPaused; });
    };

    window.resetAuction = async function() {
      if (!confirm('Reset the entire auction? This will clear all data!')) return;
      await txUpdate(s => {
        Object.assign(s, structuredClone(defaultState));
        s.nominationOrder = [0,1,2,3,4,5];
      });
      alert('Auction reset! Please add players and start again.');
    };

    window.nominatePlayer = async function() {
      if (!auctionState.isActive || auctionState.isPaused) { alert('Auction is not active or is paused!'); return; }
      const playerName = document.getElementById('player-name-input').value.trim();
      const startingBid = parseFloat(document.getElementById('starting-bid-input').value);
      if (!playerName) { alert('Please enter a player name'); return; }
      if (!auctionState.availablePlayers.includes(playerName)) { alert('Player not in available list or already drafted.'); return; }
      if (!startingBid || startingBid < 2 || (startingBid % 0.5 !== 0)) { alert('Starting bid must be ‚â•2k in steps of 0.5k'); return; }

      await txUpdate(s => {
        const idx = s.nominationOrder[s.currentNominationIndex];
        const team = s.teams[idx];
        s.currentPlayer = playerName;
        s.nominatingTeam = team.name;
        s.initialBid = startingBid;
        s.currentBid = startingBid;
        s.leadingTeam = team.name;
        s.previousBid = 0;
        s.previousLeader = null;
        s.bidHistory = s.bidHistory || [];
        s.bidHistory.push({ ts: Date.now(), player: playerName, team: team.name, amount: startingBid });

        // stop nomination timer; start bid window cooldown->countdown (20s + 5s)
        s.nominationEndsAt = null;
        const now = Date.now();
        s.bidWindowOpensAt = now + 7_500;
        s.bidWindowEndsAt  = now + 12_500;
      });

      document.getElementById('player-name-input').value = '';
      document.getElementById('starting-bid-input').value = '';
    };

    async function attemptFinalizeBid() {
      // Debounce attempts across clients
      const now = Date.now();
      if (now - lastFinalizeAttempt < 1200) return;
      lastFinalizeAttempt = now;

      await txUpdate(s => {
        if (!s.currentPlayer) return;
        if (!s.bidWindowEndsAt || Date.now() < s.bidWindowEndsAt) return;

        const winningTeam = s.teams.find(t => t.name === s.leadingTeam);
        if (!winningTeam) { // safety
          // Reset current auction if corrupted
          s.currentPlayer = null;
          s.leadingTeam = null;
          s.currentBid = 0;
          s.initialBid = 0;
          s.previousBid = 0;
          s.previousLeader = null;
          s.bidWindowOpensAt = null;
          s.bidWindowEndsAt = null;
          return;
        }

        // Deduct budget and add player
        winningTeam.budget -= s.currentBid;
        winningTeam.players = winningTeam.players || [];
        winningTeam.players.push({ name: s.currentPlayer, cost: s.currentBid });

        // Add to drafted list
        s.draftedPlayers = s.draftedPlayers || [];
        s.draftedPlayers.push({ player: s.currentPlayer, team: winningTeam.name, finalBid: s.currentBid });

        // Remove from available players
        if (Array.isArray(s.availablePlayers)) {
          const index = s.availablePlayers.indexOf(s.currentPlayer);
          if (index > -1) s.availablePlayers.splice(index,1);
        }

        // Clear current auction fields
        s.currentPlayer = null;
        s.nominatingTeam = null;
        s.initialBid = 0;
        s.currentBid = 0;
        s.leadingTeam = null;
        s.previousBid = 0;
        s.previousLeader = null;
        s.bidWindowOpensAt = null;
        s.bidWindowEndsAt = null;

        // Move to next nomination
        s.currentNominationIndex++;
        if (s.currentNominationIndex >= s.nominationOrder.length) {
          s.currentNominationIndex = 0;
          s.roundNumber++;
        }
        // Start nomination timer for next team
        s.nominationEndsAt = Date.now() + 90_000;
      });
    }

    async function autoNominateIfDue() {
      const now = Date.now();
      if (now - lastAutoNomAttempt < 1200) return;
      lastAutoNomAttempt = now;

      await txUpdate(s => {
        if (!s.isActive || s.isPaused) return;
        if (s.currentPlayer) return; // already nominating/bidding
        if (!s.nominationEndsAt || Date.now() < s.nominationEndsAt) return;
        if (!s.availablePlayers || s.availablePlayers.length === 0) return;

        // pick random player
        const rp = s.availablePlayers[Math.floor(Math.random() * s.availablePlayers.length)];
        const idx = s.nominationOrder[s.currentNominationIndex];
        const nomTeam = s.teams[idx];

        s.currentPlayer = rp;
        s.nominatingTeam = nomTeam.name;
        s.initialBid = 2;
        s.currentBid = 2;
        s.leadingTeam = nomTeam.name;
        s.previousBid = 0;
        s.previousLeader = null;

        s.bidHistory = s.bidHistory || [];
        s.bidHistory.push({ ts: Date.now(), player: rp, team: nomTeam.name, amount: 2 });

        // stop nomination timer; start bid window
        s.nominationEndsAt = null;
        const t = Date.now();
        s.bidWindowOpensAt = t + 7_500;
        s.bidWindowEndsAt  = t + 12_500;
      });
    }

    window.placeBid = async function(teamId, increment) {
      if (!auctionState.isActive || auctionState.isPaused || !auctionState.currentPlayer) { alert('No active auction or paused.'); return; }
      await txUpdate(s => {
        if (!s.currentPlayer) return;
        const team = s.teams[teamId];
        const newBid = (s.currentBid || 0) + increment;
        const maxBid = calcMaxBidCloud(team);
        if (newBid > maxBid || newBid > team.budget) return; // ignore invalid
        if (s.currentBid > 0 && s.leadingTeam) {
          s.previousBid = s.currentBid;
          s.previousLeader = s.leadingTeam;
        }
        s.currentBid = newBid;
        s.leadingTeam = team.name;
        s.bidHistory = s.bidHistory || [];
        s.bidHistory.push({ ts: Date.now(), player: s.currentPlayer, team: team.name, amount: newBid });

        // Reset bid window (20s cool + 5s countdown)
        const now = Date.now();
        s.bidWindowOpensAt = now + 7_500;
        s.bidWindowEndsAt  = now + 12_500;
      });
    };

    function calcMaxBidCloud(team) {
      const players = team.players || [];
      const playersNeeded = 6 - players.length;
      const reserveBudget = Math.max(0, (playersNeeded - 1) * 2);
      return Math.max(2, team.budget - reserveBudget);
    }

    window.placeMaxBid = async function(teamId) {
      if (!auctionState.isActive || auctionState.isPaused || !auctionState.currentPlayer) { alert('No active auction or paused.'); return; }
      await txUpdate(s => {
        if (!s.currentPlayer) return;
        const team = s.teams[teamId];
        const maxBid = calcMaxBidCloud(team);
        if (maxBid <= s.currentBid) return;
        if (maxBid > team.budget) return;

        if (s.currentBid > 0 && s.leadingTeam) {
          s.previousBid = s.currentBid;
          s.previousLeader = s.leadingTeam;
        }
        s.currentBid = maxBid;
        s.leadingTeam = team.name;
        s.bidHistory = s.bidHistory || [];
        s.bidHistory.push({ ts: Date.now(), player: s.currentPlayer, team: team.name, amount: maxBid });

        const now = Date.now();
        s.bidWindowOpensAt = now + 7_500;
        s.bidWindowEndsAt  = now + 12_500;
      });
    };

    window.placeCustomBid = async function(teamId) {
      if (!auctionState.isActive || auctionState.isPaused || !auctionState.currentPlayer) { alert('No active auction or paused.'); return; }
      const input = document.getElementById(`custom-bid-${teamId}`);
      const customBid = parseFloat(input.value);
      if (!customBid || customBid <= 0) { alert('Enter a valid bid'); return; }
      if (customBid % 0.5 !== 0) { alert('Bid must be in increments of 0.5k'); return; }
      await txUpdate(s => {
        if (!s.currentPlayer) return;
        const team = s.teams[teamId];
        const maxBid = calcMaxBidCloud(team);
        if (customBid > maxBid || customBid > team.budget) return;
        if (customBid <= s.currentBid) return;

        if (s.currentBid > 0 && s.leadingTeam) {
          s.previousBid = s.currentBid;
          s.previousLeader = s.leadingTeam;
        }
        s.currentBid = customBid;
        s.leadingTeam = team.name;
        s.bidHistory = s.bidHistory || [];
        s.bidHistory.push({ ts: Date.now(), player: s.currentPlayer, team: team.name, amount: customBid });

        const now = Date.now();
        s.bidWindowOpensAt = now + 7_500;
        s.bidWindowEndsAt  = now + 12_500;
      });
      input.value = '';
    };

    window.undoLastBid = async function() {
      if ((auctionState.bidHistory || []).length <= 1) { alert('No bid to undo!'); return; }
      await txUpdate(s => {
        if (!s.bidHistory || s.bidHistory.length <= 1) return;
        // Remove last bid
        s.bidHistory.pop();
        const prev = s.bidHistory[s.bidHistory.length - 1];
        if (prev) {
          s.previousBid = s.currentBid;
          s.previousLeader = s.leadingTeam;
          s.currentBid = prev.amount;
          s.leadingTeam = prev.team;
        } else {
          // back to initial state of nomination
          s.previousBid = 0;
          s.previousLeader = null;
          s.currentBid = s.initialBid || 0;
          s.leadingTeam = s.nominatingTeam || null;
        }
        // restart bid window
        const now = Date.now();
        s.bidWindowOpensAt = now + 7_500;
        s.bidWindowEndsAt  = now + 12_500;
      });
    };

    window.exportData = function() {
      if ((auctionState.draftedPlayers || []).length === 0) { alert('No players drafted yet!'); return; }
      let csv = "Player,Team,Final Bid (k)\n";
      auctionState.draftedPlayers.forEach(d => {
        const p = d.player.includes(',') ? `"${d.player}"` : d.player;
        const t = d.team.includes(',') ? `"${d.team}"` : d.team;
        csv += `${p},${t},${d.finalBid}\n`;
      });
      csv += "\n\nSummary Statistics\nTeam,Players Drafted,Total Spent (k),Budget Remaining (k)\n";
      (auctionState.teams || []).forEach(team => {
        const spent = 100 - team.budget;
        const count = (team.players || []).length;
        const tname = team.name.includes(',') ? `"${team.name}"` : team.name;
        csv += `${tname},${count},${spent},${team.budget}\n`;
      });
      const date = new Date();
      const dateStr = `${date.getFullYear()}-${String(date.getMonth()+1).padStart(2,'0')}-${String(date.getDate()).padStart(2,'0')}`;
      const timeStr = `${String(date.getHours()).padStart(2,'0')}-${String(date.getMinutes()).padStart(2,'0')}`;
      const filename = `drafted_players_${dateStr}_${timeStr}_round${auctionState.roundNumber}.csv`;
      const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
      const url2 = window.URL.createObjectURL(blob);
      const link = document.createElement('a');
      link.href = url2;
      link.download = filename;
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      window.URL.revokeObjectURL(url2);
    };

    /***********************
     * Timers (cloud-synced)
     ***********************/
    function updateTimerCards() {
      // Bid countdown
      const cdCard = document.getElementById('countdown-timer-card');
      const cd = document.getElementById('countdown-timer');
      const openAt = auctionState.bidWindowOpensAt;
      const endAt  = auctionState.bidWindowEndsAt;
      const now = Date.now();

      if (auctionState.currentPlayer && openAt && endAt) {
        if (now < openAt) {
          cdCard.className = 'timer-card inactive';
          cd.textContent = '--';
        } else if (now >= openAt && now < endAt) {
          cdCard.className = 'timer-card active';
          const secs = Math.max(0, Math.ceil((endAt - now)/1000));
          cd.textContent = secs;
        } else {
          cdCard.className = 'timer-card inactive';
          cd.textContent = '--';
          // Try finalize
          attemptFinalizeBid();
        }
      } else {
        cdCard.className = 'timer-card inactive';
        cd.textContent = '--';
      }

      // Nomination timer
      const ntCard = document.getElementById('nomination-timer-card');
      const nt = document.getElementById('nomination-timer');
      const nomEnd = auctionState.nominationEndsAt;
      if (!auctionState.currentPlayer && nomEnd) {
        if (now < nomEnd) {
          ntCard.className = 'timer-card active';
          const remaining = Math.max(0, nomEnd - now);
          const m = Math.floor(remaining/60000);
          const s = Math.floor((remaining%60000)/1000);
          nt.textContent = `${m}:${String(s).padStart(2,'0')}`;
        } else {
          ntCard.className = 'timer-card inactive';
          nt.textContent = '--';
          // Try auto nominate
          autoNominateIfDue();
        }
      } else {
        ntCard.className = 'timer-card inactive';
        nt.textContent = '--';
      }
    }

    setInterval(updateTimerCards, 300);

    /***********************
     * Page init
     ***********************/
    function setupPlayerAutocomplete() {
      const playerInput = document.getElementById('player-name-input');
      playerInput.addEventListener('input', function() {
        const value = this.value.toLowerCase();
        if (value.length < 2) return;
        const matches = (auctionState.availablePlayers || []).filter(p => p.toLowerCase().includes(value)).slice(0,5);
        let datalist = document.getElementById('player-suggestions');
        if (!datalist) {
          datalist = document.createElement('datalist');
          datalist.id = 'player-suggestions';
          document.body.appendChild(datalist);
          playerInput.setAttribute('list', 'player-suggestions');
        }
        datalist.innerHTML = '';
        matches.forEach(p => {
          const option = document.createElement('option');
          option.value = p;
          datalist.appendChild(option);
        });
      });
    }

    // Build empty team setup table on first load (UI only)
    initializeTeamSetupTable();
    setupPlayerAutocomplete();

    // Disable bid buttons / nominate until active (render handles state)
    document.getElementById('nominate-btn').disabled = true;

  </script>
</body>
</html>
